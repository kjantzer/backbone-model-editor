<html>
<head>

<title>Backbone.js Model Editor View</title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44608486-4', 'kjantzer.github.io');
  ga('send', 'pageview');

</script>

<!-- Backbone.js Dependencies -->
<script src="lib/jquery.min.js"></script>
	<!-- add jQuery UI if you want a date selector -->
<script src="lib/underscore.min.js"></script>
<script src="lib/underscore.string.min.js"></script>
<script src="lib/backbone.min.js"></script>
<script src="lib/backbone.subviews.js"></script>
<script src="lib/util.js"></script>
<script type="text/javascript">
	
	// mixin underscore.string
	_.mixin(_.str.exports());
	
	_.mixin({
		cleanWebkitStyles: function(val){
			return val.replace(/ style="font-size: initial; line-height: initial;"/g, '') // remove inline styles
						.replace(/<span>|<\/span>/g, '') // and empty spans
		},
		// https://gist.github.com/kjantzer/503e46328ff692bfe38b
		// note: this could be improved to NOT change quotes inside HTML tags, but for now we don't need it
		smartQuotes: function(str){
			return str = (str||'').replace(/\b'\b/g, "\u2019")  // apostrophes
					.replace(/'(?=[^>]*<)\b/g, "\u2018")     				// Opening singles
					.replace(/\b([\.\?\!,]*)(?=[^>]*<)'/g, "$1\u2019")     // Closing singles
					.replace(/"(?=[^>]*<)\b/g, "\u201c")     				// Opening doubles
					.replace(/\b([\.\?\!,]*)(?=[^>]*<)"/g, "$1\u201d")     // Closing doubles
					.replace(/\.\.\./g,  "\u2026")     			// ellipsis
					.replace(/--/g,  "\u2014")     				// em-dashes
		}
	})
</script>

<!-- Bootstrap 3 - http://getbootstrap.com -->
<link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">

<!-- Model Editor script -->
<link href="style.css" rel="stylesheet" type="text/css">
<script src="model-editor.min.js"></script>

<style>
body {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

.model-editor label { font-weight: bold !important;}
</style>

</head>
<body>

<div class="navbar">
  <div class="container">

    <a class="navbar-brand" href="#">Blackstone UI Components</a>

    <ul class="nav navbar-nav">
	  <li class=""><a href="http://kjantzer.github.io/backbonejs-list-controller-view/">List Controller</a></li>
	  <li class=""><a href="http://kjantzer.github.io/backbonejs-panel-view/">Panel</a></li>
	  <li class=""><a href="http://kjantzer.github.io/backbonejs-dropdown-view/">Dropdown</a></li>
	  <li class=""><a href="http://kjantzer.github.io/backbonejs-modal-view/">Modal</a></li>
	  <li class="active"><a href="http://kjantzer.github.io/backbonejs-model-editor-view/">Model Editor</a></li>
	  <li class=""><a href="http://kjantzer.github.io/basic-buttons/">Basic Buttons</a></li>
	</ul>

    
  </div><!-- /.container -->
</div><!-- /.navbar -->

<a href="https://github.com/kjantzer/backbonejs-model-editor-view"><img style="position: absolute; top: 0; right: 0; border: 0; z-index:10;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>


<div class="masthead" style="position: relative; margin-top: -20px; padding-top: 20px;">
	<div style="background: #2c3033; height: 80%; position: absolute; top: 0; width: 100%;"></div>
	
	<div class="container">
		<div class="col-lg-6 col-lg-offset-3">
		
		<div style="color: white;">
		<h1>Model Editor View</h1>
		<p style="font-weight: 300; line-height: 1.3em; font-size: 1.5em;">Easily edit your backbone models with inputs, textareas, date pickers, and more.</p>
		<br>
		</div>
		
		<div id="editors" class="clearfix panel" style="padding: 30px;"></div>
	
		</div>
	</div>
</div>

<div class="container">
	<div class="col-lg-6 col-lg-offset-3">
	
		<br>
		<h4>Unsaved Editor Model</h4>
		<pre id="output"></pre>
		
		<h4>Real Model Data</h4>
		<pre id="output2"></pre>
		
		<hr>
		
		<small>Built by Kevin Jantzer, Blackstone Audio Inc.</small>
		<br><br>
	
	</div>
</div>

<script type="text/javascript">
$(function() {

window.App = Backbone.View.extend({
	
	el: '#editors',
	
	events: {
		'click .save': 'save',
		'click .reset': 'reset'
	},
	
	initialize: function(){
		
		this.model = new Backbone.Model({
			name:null,
			gender: null,
			phone:null, 
			email:null,
			color: null,
			notes: null
		});
		
/*
	THIS IS WHERE THE MAGIC HAPPENS
*/
		this.editor = new ModelEditor({
			model: this.model,
			el: this.el,
			autoSave: false,
			saveToDB: false,
			defaultOpts: {			// set the default options for all editors (these can be overridden at anytime
				labelInline: 100
			}
		})
		
		// show the model values everytime there is a change in the editor
		this.editor.editmodel.on('change', this.showOutput, this);
		this.editor.editmodel.on('reset', this.render, this);
		
		this.anotherView = new anotherView();
		
		this.$output = $('#output');
		this.$output2 = $('#output2');
		
		this.render();
	},
	
	render: function(){
		
		this.$el.html('');

		this.editor.cleanup();
		
/*
	THIS IS WHERE THE MAGIC HAPPENS
	
	editors can be created with one liners
*/
		this.editor.insert('input', 'name');
		this.editor.insert('select', 'gender', {values: [{label:'-', val:null}, 'Male', 'Female']});
		this.editor.insert('input', 'phone');
		this.editor.insert('email', 'email');
		this.editor.insert('multiselect', 'color', {values: ['Red', 'Blue', 'Green', 'Yellow', 'Orange', 'Purple'], label: 'Favorite Color(s)'});
		this.editor.insert('textarea', 'notes', {w: 300, h: 100});
		this.editor.insert('checkbox', 'newsletter');
		
		this.editor.insert('empty', 'custom', {view: this.anotherView});
		
		this.$el.append('<div class="clear clearfix"><a class="btn btn-primary save">Save</a> <a class="btn btn-default reset">Reset</a></div>')
		
		this.delegateEvents();
	},
	
	save: function(){
	
		this.editor.save(); // this saves the data from the editor
		
		var str = JSON.stringify(this.model.toJSON());
		
		this.$output2.html( JSON.stringify(this.model.toJSON()) );
	},
	
	reset: function(){
		this.editor.reset();
		this.showOutput();
		this.render();
	},
	
	showOutput: function(){
		this.$output.html( JSON.stringify(this.editor.editmodel.toJSON()) );
	},
	
})

var anotherView = Backbone.View.extend({
	
	initialize: function(){
		this.$el.width('300px');
	},
	
	render: function(){
		this.$el.html('This is another backbone view. It can be responsible for rendering the controls/ui for this section')
		return this;
	}
})

// start the new app
window.app = new App();
	

});
</script>

</body>
</html>
